---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# vnorm

<img src="man/figures/logo.png" align="right" width="180" />

[![CRAN status](https://img.shields.io/badge/CRAN-not%20released-lightgrey)](https://cran.r-project.org/package=vnorm)
[![repo status](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![Coverage](https://github.com/sonish13/vnorm/actions/workflows/coverage.yaml/badge.svg?branch=main)](https://github.com/sonish13/vnorm/actions/workflows/coverage.yaml)
![coverage](https://img.shields.io/badge/coverage-84%25-brightgreen)

The goal of vnorm is to sample from variety normal distributions.
For faster computation, several models are pre-compiled on installation.
The package also lets users pre-compile models for one polynomial shape
and reuse them for related polynomials with different coefficients.
Other uses include plotting 1D varieties in 2D and projecting points onto
varieties.

# Sampling from a variety

Generate samples from the variety normal distribution with mean equal to
`poly` and "standard deviation" equal to `sd`.

For a polynomial $x^2 + y^2 - 1$, we can sample using `rvnorm()`

```{r}
library("vnorm")
poly <- mp("x^2 + y^2 -1")
samps <- rvnorm(2000, poly, sd = .1)

head(samps)

str(samps)
```

Let's plot this with ggplot:

```{r}
library("ggplot2")
ggplot(samps, aes(x = x , y = y)) +
  geom_point() +
  coord_equal()
```

We can use pre-compiled Stan models for polynomials with degree up to 3
and at most 3 indeterminates. This avoids repeated Stan compilation.

```{r}
poly <- mp("x^2 + y^2 + z^2 - 1")
samps <- rvnorm(2000, poly, sd = 0.1, pre_compiled = TRUE)
head(samps)
```

We also want the user to be able to pre-compile models. This can be done with
[compile_stan_code()]. This helps avoid re-compiling Stan models for similar
polynomials with different coefficients.

```{r}
poly <- mp("x^4 + y^4 - 1")
compile_stan_code(poly = poly)
```

Here we compile a Stan model for polynomials of the form
$ax^4 + by^4 - 1$. We can then reuse that model in `rvnorm()` for similar
polynomials by setting `user_compiled = TRUE`.

```{r}
poly <- mp("2 x^4 + 3 y^4 - 1")
samps <- rvnorm(1000, poly = poly, sd = 0.1, user_compiled = TRUE)
head(samps)
```

# Plotting

`vnorm` includes `geom_variety()`, a ggplot2-compatible geom for plotting
1D varieties. It supports single-polynomial (`mpoly`) and multi-polynomial
(`mpolyList`) inputs.

```{r}
ggplot() +
 geom_variety(poly = mp("y - x^2")) +
 coord_equal()
```

```{r}
ggplot() +
  geom_variety(
    poly = mp(c("x^2 + y^2 - 1", "y - x")) ,
    xlim = c(-2, 2), ylim = c(-2, 2)) +
  coord_equal()
```


## Installation

You can install the development version of vnorm from
[GitHub](https://github.com/) with:

``` r
if (!requireNamespace("devtools")) install.packages("devtools")
devtools::install_github("dkahle/mpoly")
devtools::install_github("sonish13/vnorm")
```
