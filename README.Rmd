---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(mpoly)
library(stringr)
library(cmdstanr)
```

# vnorm

The goal of vnorm is to sample from variety normal distributions. For faster computation, several models are pre-compiled upon installation. See below for more information. The package also enables users to be able to pre-compile models for certain polynomials and let them use it for similar polynomials with different coefficients. Other usage include plotting 1d varieties in 2d plots and projection onto varieties. 

# Sampling from a variety

Generate samples for the variety normal distribution with mean equal to `poly` and "standard deviation" equal to `sd`.

For a polynomial $x^2 + y^2 -1$, we can sample using `rvnorm`

```{r}
library(vnorm)
poly <- mpoly::mp("x^2 + y^2 -1")
samps <- rvnorm(2000, poly, sd = .1)
head(samps)
str(samps)
```

Let's plot this with ggplot:

```{r}
library(ggplot2)
samps |> 
  ggplot(aes(x = x , y = y)) +
  geom_point() +
  coord_equal()
```

We can use pre-compiled stan models for polynomials with degree upto 3 and polynomial with upto 3 indeterminates. This helps avoid compiling stan models. 

```{r}
poly <- mpoly::mp("x^2 + y^2 + z^2 - 1")
samps <- rvnorm(2000, poly, sd = 0.1, pre_compiled = TRUE)
head(samps)
```

We also want the user to be able to pre-compile models. This can be done with `compile_stan_code`. This helps avoid re-compiling stan model for similar polynomial with different coefficients.

```{r}
poly <- mpoly::mp("x^4 + y^4 - 1")
compile_stan_code(poly = poly)
```

Here we have compiled stan model for polynomial of the type $ax^4 + by^4 -1 $. Now, we can use the pre-compiled model with rvnorm for similar polynomial. The `user_compiled` argument is what we will use for this.

```{r}
poly <- mpoly::mp("2 x^4 + 3 y^4 - 1")
samps <- rvnorm(1000, poly = poly, sd = 0.1, user_compiled = TRUE)
head(samps)
```

# Plotting

`vnorm` has `geom_variety` which is ggplot2 compliant in order to plot 1d varieties. We can plot varieties for single(mpoly object) or multiple(mpolyList object) polynomails `geom_variety()`.

```{r}
poly <- mpoly::mp("y - x^2")
ggplot() +
 geom_variety(poly = poly) +
 coord_equal()
```

```{r}
p1 <- mp("x^2 + y^2 - 1")
p2 <- mp("y - x")
poly <- mpolyList(p1, p2)
ggplot() +
  geom_variety(poly = poly , xlim = c(-2, 2), ylim = c(-2, 2)) +
  coord_equal()
```


## Installation

You can install the development version of vnorm from [GitHub](https://github.com/) with:

``` r
if (!requireNamespace("devtools")) install.packages("devtools")
devtools::install_github("dkahle/mpoly")
devtools::install_github("sonish13/vnorm)
```
